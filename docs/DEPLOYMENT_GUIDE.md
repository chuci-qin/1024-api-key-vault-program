# 1024 API Key Vault Program - éƒ¨ç½²å’Œä½¿ç”¨å®Œæ•´æŒ‡å—

**ç‰ˆæœ¬**: v0.1.1  
**éƒ¨ç½²æ—¥æœŸ**: 2025-11-17  
**ç½‘ç»œ**: 1024Chain Testnet  
**çŠ¶æ€**: âœ… å·²éƒ¨ç½²å¹¶éªŒè¯

---

## ğŸ“‹ ç›®å½•

1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [éƒ¨ç½²ä¿¡æ¯](#éƒ¨ç½²ä¿¡æ¯)
3. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
4. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
5. [å®Œæ•´ä½¿ç”¨æµç¨‹](#å®Œæ•´ä½¿ç”¨æµç¨‹)
6. [API å‚è€ƒ](#api-å‚è€ƒ)
7. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## æ¦‚è¿°

### ä»€ä¹ˆæ˜¯ 1024 API Key Vault Program?

1024 API Key Vault Program æ˜¯ä¸€ä¸ªéƒ¨ç½²åœ¨ 1024Chain ä¸Šçš„**å®Œå…¨éæ‰˜ç®¡**æ™ºèƒ½åˆçº¦ï¼Œä¸º 1024EX æ°¸ç»­åˆçº¦äº¤æ˜“æ‰€å’Œ 1024Quant é‡åŒ–å¹³å°æä¾›ï¼š

- âœ… **ç”¨æˆ·ä¸“å±é‡‘åº“ (Vault)** - æ¯ä¸ªç”¨æˆ·æ‹¥æœ‰ç‹¬ç«‹çš„é“¾ä¸Šé‡‘åº“å­˜å‚¨ USDC
- âœ… **å¤š API Key æˆæƒ** - æ”¯æŒåˆ›å»ºå¤šä¸ª API Keyï¼Œæ¯ä¸ªç­–ç•¥ç‹¬ç«‹æˆæƒ
- âœ… **ç²¾ç»†æƒé™æ§åˆ¶** - äº¤æ˜“ã€æç°ã€åªå¹³ä»“ç­‰å¤šç§æƒé™ç»„åˆ
- âœ… **é£é™©é™é¢ç®¡ç†** - æ¯ä¸ª API Key ç‹¬ç«‹çš„æ•å£é™é¢
- âœ… **å¯æ’¤é”€æˆæƒ** - éšæ—¶ä½œåºŸä»»ä½• API Keyï¼Œç«‹å³ç”Ÿæ•ˆ

### æ ¸å¿ƒä¼˜åŠ¿

1. **å®Œå…¨éæ‰˜ç®¡**
   - é¡¹ç›®æ–¹ä¸æŒæœ‰ç”¨æˆ·ç§é’¥
   - èµ„é‡‘ç”±æ™ºèƒ½åˆçº¦æ§åˆ¶ï¼Œæ— åé—¨
   - å¯é€šè¿‡ `RenounceAdmin` å®ç°å®Œå…¨å»ä¸­å¿ƒåŒ–

2. **é‡åŒ–å‹å¥½**
   - ç±»ä¼¼ CEX çš„ API Key ä½“éªŒ
   - æ”¯æŒ 7Ã—24 è‡ªåŠ¨äº¤æ˜“
   - å¤šç­–ç•¥éš”ç¦»ï¼Œé£é™©å¯æ§

3. **ç»Ÿä¸€èµ„é‡‘å±‚**
   - ä¸€ä»½ä¿è¯é‡‘å¯ç”¨äºå¤šä¸ªäº§å“
   - é¿å…èµ„é‡‘åˆ†æ•£ï¼Œæé«˜åˆ©ç”¨ç‡

---

## éƒ¨ç½²ä¿¡æ¯

### ç½‘ç»œé…ç½®

```yaml
ç½‘ç»œ: 1024Chain Testnet
RPC URL: https://testnet-rpc.1024chain.com/rpc/
WebSocket: wss://testnet-rpc.1024chain.com/ws/
åŒºå—æµè§ˆå™¨: https://testnet-scan.1024chain.com/
```

### Program ä¿¡æ¯

| é¡¹ç›® | å€¼ |
|------|-----|
| **Program ID** | `3CioJbGydCvrRidfB2fbKzcpFUadtap6S7e5MHTm4XRe` |
| **GlobalConfig PDA** | `Fjn64GP2tRzMVucy8R1M3vL8ZqmEyxqtStgvkFFDFgZr` |
| **USDC Mint** | `6u1x12yV2XFcEDGd8KByZZqnjipRiq9BJB2xKprhAipy` |
| **Admin** | `J1Szw8HZYL95NvYUsNhg3e6NzKQLUZ9UxQsKg4hsQnad` |
| **Program Size** | 161,336 bytes (157 KB) |
| **Deployment Slot** | 17430785 |

### é…ç½®æ–‡ä»¶ä½ç½®

```bash
scripts/config.json  # åŒ…å«æ‰€æœ‰éƒ¨ç½²é…ç½®
```

---

## æ¶æ„è®¾è®¡

### æ ¸å¿ƒè´¦æˆ·ç±»å‹

#### 1. GlobalConfig (å…¨å±€é…ç½®å•ä¾‹)

```rust
pub struct GlobalConfig {
    pub discriminator: u64,    // è´¦æˆ·ç±»å‹æ ‡è¯†
    pub version: u8,           // é…ç½®ç‰ˆæœ¬
    pub bump: u8,              // PDA bump
    pub admin: Pubkey,         // ç®¡ç†å‘˜ï¼ˆå¯æ”¾å¼ƒï¼‰
    pub usdc_mint: Pubkey,     // USDC Mint åœ°å€
    pub created_at: i64,       // åˆ›å»ºæ—¶é—´
    pub reserved: [u8; 64],    // é¢„ç•™æ‰©å±•
}
```

**PDA Seeds**: `["global", 1]`

#### 2. UserVault (ç”¨æˆ·é‡‘åº“)

```rust
pub struct UserVault {
    pub discriminator: u64,       // è´¦æˆ·ç±»å‹æ ‡è¯†
    pub version: u8,              // æ•°æ®ç‰ˆæœ¬
    pub bump: u8,                 // Vault PDA bump
    pub usdc_bump: u8,            // USDC Token Account bump
    pub owner: Pubkey,            // ç”¨æˆ·ä¸»é’±åŒ…
    pub usdc_vault: Pubkey,       // USDC Token Account
    pub total_deposit: u64,       // å†å²æ€»å­˜å…¥
    pub total_withdrawn: u64,     // å†å²æ€»æå‡º
    pub free_collateral: u64,     // å¯ç”¨ä¿è¯é‡‘
    pub locked_collateral: u64,   // é”å®šä¿è¯é‡‘
    pub flags: u64,               // çŠ¶æ€æ ‡è®°ï¼ˆå†»ç»“ç­‰ï¼‰
    pub created_at: i64,          // åˆ›å»ºæ—¶é—´
    pub updated_at: i64,          // æ›´æ–°æ—¶é—´
    pub reserved: [u8; 64],       // é¢„ç•™æ‰©å±•
}
```

**PDA Seeds**: `["vault", owner_pubkey]`

#### 3. DelegateAccount (API Key æˆæƒ)

```rust
pub struct DelegateAccount {
    pub discriminator: u64,    // è´¦æˆ·ç±»å‹æ ‡è¯†
    pub version: u8,           // æ•°æ®ç‰ˆæœ¬
    pub bump: u8,              // PDA bump
    pub owner: Pubkey,         // Vault æ‰€æœ‰è€…
    pub vault: Pubkey,         // å¯¹åº”çš„ UserVault
    pub delegate: Pubkey,      // API Key å…¬é’¥
    pub is_active: bool,       // æ˜¯å¦æ¿€æ´»
    pub permissions: u64,      // æƒé™ä½æ©ç 
    pub max_notional: u64,     // æœ€å¤§å¯ç”¨æ•å£
    pub used_notional: u64,    // å½“å‰å·²ç”¨æ•å£
    pub expiry_slot: u64,      // è¿‡æœŸ slot
    pub nonce: u64,            // é˜²é‡æ”¾è®¡æ•°å™¨
    pub created_at: i64,       // åˆ›å»ºæ—¶é—´
    pub updated_at: i64,       // æ›´æ–°æ—¶é—´
    pub reserved: [u8; 64],    // é¢„ç•™æ‰©å±•
}
```

**PDA Seeds**: `["delegate", owner_pubkey, delegate_pubkey]`

### æƒé™ç³»ç»Ÿ

```rust
// æƒé™ä½å®šä¹‰
pub const PERM_TRADE: u64 = 1 << 0;       // å…è®¸äº¤æ˜“
pub const PERM_WITHDRAW: u64 = 1 << 1;    // å…è®¸æç°
pub const PERM_CLOSE_ONLY: u64 = 1 << 2;  // åªå…è®¸å¹³ä»“
pub const PERM_VIEW_ONLY: u64 = 1 << 3;   // åªè¯»æƒé™
```

**æƒé™ç»„åˆç¤ºä¾‹**:
- åªäº¤æ˜“: `permissions = 1` (PERM_TRADE)
- äº¤æ˜“+æç°: `permissions = 3` (PERM_TRADE | PERM_WITHDRAW)
- åªå¹³ä»“: `permissions = 5` (PERM_TRADE | PERM_CLOSE_ONLY)
- å®Œå…¨æƒé™: `permissions = 7` (PERM_TRADE | PERM_WITHDRAW | PERM_CLOSE_ONLY)

---

## å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

```bash
# å®‰è£… Solana CLI
sh -c "$(curl -sSfL https://release.solana.com/stable/install)"

# é…ç½® RPC
solana config set --url https://testnet-rpc.1024chain.com/rpc/

# éªŒè¯è¿æ¥
solana epoch-info
```

### ç¯å¢ƒé…ç½®

```bash
# å…‹éš†ä»“åº“
cd /path/to/1024-api-key-vault-program

# æŸ¥çœ‹é…ç½®
cat scripts/config.json
```

### é…ç½®æ–‡ä»¶è¯´æ˜

```json
{
  "program_id": "3CioJbGydCvrRidfB2fbKzcpFUadtap6S7e5MHTm4XRe",
  "usdc_mint": "6u1x12yV2XFcEDGd8KByZZqnjipRiq9BJB2xKprhAipy",
  "rpc_url": "https://testnet-rpc.1024chain.com/rpc/",
  "network": "1024chain-testnet",
  "test_accounts": {
    "account1": {
      "pubkey": "9ocm9zv5F2QghKaFSLGSjkVg6f8XZf54nVTjfC2M3dG4",
      "secret": "65d7pAydmKwgo5mVBwnKQUS7BUP1ZBhisEbeRyfzFnGLez85AGSqcqbZCUbsccogzSyLBqYcoZVgU7x7AARtKMHz"
    }
  }
}
```

---

## å®Œæ•´ä½¿ç”¨æµç¨‹

### 1. åˆ›å»º Vault

#### 1.1 å‡†å¤‡å·¥ä½œ

```typescript
import { Connection, PublicKey, Keypair } from '@solana/web3.js';
import bs58 from 'bs58';

// è¿æ¥
const connection = new Connection('https://testnet-rpc.1024chain.com/rpc/');

// ç”¨æˆ·é’±åŒ…ï¼ˆä½¿ç”¨æµ‹è¯•è´¦æˆ· #1ï¼‰
const owner = Keypair.fromSecretKey(
  bs58.decode("65d7pAydmKwgo5mVBwnKQUS7BUP1ZBhisEbeRyfzFnGLez85AGSqcqbZCUbsccogzSyLBqYcoZVgU7x7AARtKMHz")
);

// Program ID
const PROGRAM_ID = new PublicKey("3CioJbGydCvrRidfB2fbKzcpFUadtap6S7e5MHTm4XRe");
const USDC_MINT = new PublicKey("6u1x12yV2XFcEDGd8KByZZqnjipRiq9BJB2xKprhAipy");
```

#### 1.2 æ´¾ç”Ÿ PDA

```typescript
// UserVault PDA
const [vaultPDA, vaultBump] = PublicKey.findProgramAddressSync(
  [Buffer.from("vault"), owner.publicKey.toBuffer()],
  PROGRAM_ID
);

// Vault USDC Token Account PDA
const [vaultUsdcPDA, vaultUsdcBump] = PublicKey.findProgramAddressSync(
  [Buffer.from("vault-usdc"), owner.publicKey.toBuffer()],
  PROGRAM_ID
);

console.log('Vault PDA:', vaultPDA.toBase58());
console.log('Vault USDC PDA:', vaultUsdcPDA.toBase58());
```

#### 1.3 æ„é€  CreateVault æŒ‡ä»¤

```typescript
import { 
  Transaction, 
  TransactionInstruction,
  SystemProgram,
  SYSVAR_RENT_PUBKEY 
} from '@solana/web3.js';
import { TOKEN_PROGRAM_ID } from '@solana/spl-token';

// GlobalConfig PDA
const [globalConfigPDA] = PublicKey.findProgramAddressSync(
  [Buffer.from("global"), Buffer.from([1])],
  PROGRAM_ID
);

// æŒ‡ä»¤æ•°æ® (VaultInstruction::CreateVault = 1)
const instructionData = Buffer.from([1]); // åªæœ‰æŒ‡ä»¤ç´¢å¼•

// æ„é€ æŒ‡ä»¤
const createVaultIx = new TransactionInstruction({
  keys: [
    { pubkey: vaultPDA, isSigner: false, isWritable: true },
    { pubkey: vaultUsdcPDA, isSigner: false, isWritable: true },
    { pubkey: owner.publicKey, isSigner: true, isWritable: true },
    { pubkey: globalConfigPDA, isSigner: false, isWritable: false },
    { pubkey: USDC_MINT, isSigner: false, isWritable: false },
    { pubkey: SystemProgram.programId, isSigner: false, isWritable: false },
    { pubkey: TOKEN_PROGRAM_ID, isSigner: false, isWritable: false },
    { pubkey: SYSVAR_RENT_PUBKEY, isSigner: false, isWritable: false },
  ],
  programId: PROGRAM_ID,
  data: instructionData,
});

// å‘é€äº¤æ˜“
const tx = new Transaction().add(createVaultIx);
const signature = await connection.sendTransaction(tx, [owner]);
await connection.confirmTransaction(signature);

console.log('âœ… Vault created! Signature:', signature);
```

---

### 2. å­˜æ¬¾ USDC

#### 2.1 åˆ›å»º/è·å– Token Account

```typescript
import { 
  getOrCreateAssociatedTokenAccount,
  getAssociatedTokenAddress 
} from '@solana/spl-token';

// è·å–æˆ–åˆ›å»ºç”¨æˆ·çš„ USDC Token Account
const userUsdcAccount = await getOrCreateAssociatedTokenAccount(
  connection,
  owner,
  USDC_MINT,
  owner.publicKey
);

console.log('User USDC Account:', userUsdcAccount.address.toBase58());
```

#### 2.2 æ„é€  Deposit æŒ‡ä»¤

```typescript
import * as borsh from 'borsh';

// Deposit æŒ‡ä»¤æ•°æ®ç»“æ„
class DepositData {
  instruction = 2; // VaultInstruction::Deposit
  amount: bigint;

  constructor(amount: bigint) {
    this.amount = amount;
  }
}

const depositSchema = new Map([
  [DepositData, {
    kind: 'struct',
    fields: [
      ['instruction', 'u8'],
      ['amount', 'u64'],
    ],
  }],
]);

// å­˜å…¥ 1000 USDC (æ³¨æ„ï¼šUSDC decimals = 9)
const depositAmount = 1000n * 1_000_000_000n; // 1000 USDC

const depositData = new DepositData(depositAmount);
const depositInstructionData = borsh.serialize(depositSchema, depositData);

// æ„é€ æŒ‡ä»¤
const depositIx = new TransactionInstruction({
  keys: [
    { pubkey: vaultPDA, isSigner: false, isWritable: true },
    { pubkey: owner.publicKey, isSigner: true, isWritable: false },
    { pubkey: userUsdcAccount.address, isSigner: false, isWritable: true },
    { pubkey: vaultUsdcPDA, isSigner: false, isWritable: true },
    { pubkey: globalConfigPDA, isSigner: false, isWritable: false },
    { pubkey: TOKEN_PROGRAM_ID, isSigner: false, isWritable: false },
  ],
  programId: PROGRAM_ID,
  data: Buffer.from(depositInstructionData),
});

// å‘é€äº¤æ˜“
const depositTx = new Transaction().add(depositIx);
const depositSig = await connection.sendTransaction(depositTx, [owner]);
await connection.confirmTransaction(depositSig);

console.log('âœ… Deposited 1000 USDC! Signature:', depositSig);
```

---

### 3. åˆ›å»º API Key (Delegate)

#### 3.1 ç”Ÿæˆ API Key

```typescript
// ç”Ÿæˆæ–°çš„ API Key
const apiKey = Keypair.generate();

console.log('API Key Public:', apiKey.publicKey.toBase58());
console.log('API Key Secret:', bs58.encode(apiKey.secretKey));

// âš ï¸ é‡è¦ï¼šç§é’¥åªä¿å­˜åœ¨ç”¨æˆ·ç¯å¢ƒï¼Œé¡¹ç›®æ–¹ä¸ä¿å­˜
```

#### 3.2 æ´¾ç”Ÿ DelegateAccount PDA

```typescript
const [delegatePDA, delegateBump] = PublicKey.findProgramAddressSync(
  [
    Buffer.from("delegate"),
    owner.publicKey.toBuffer(),
    apiKey.publicKey.toBuffer()
  ],
  PROGRAM_ID
);

console.log('Delegate PDA:', delegatePDA.toBase58());
```

#### 3.3 æ„é€  UpsertDelegate æŒ‡ä»¤

```typescript
// UpsertDelegate æŒ‡ä»¤æ•°æ®
class UpsertDelegateData {
  instruction = 4; // VaultInstruction::UpsertDelegate
  delegate_pubkey: Uint8Array;
  permissions: bigint;
  max_notional: bigint;
  expiry_slot: bigint;

  constructor(props: {
    delegate_pubkey: PublicKey,
    permissions: bigint,
    max_notional: bigint,
    expiry_slot: bigint
  }) {
    this.delegate_pubkey = props.delegate_pubkey.toBytes();
    this.permissions = props.permissions;
    this.max_notional = props.max_notional;
    this.expiry_slot = props.expiry_slot;
  }
}

const upsertDelegateSchema = new Map([
  [UpsertDelegateData, {
    kind: 'struct',
    fields: [
      ['instruction', 'u8'],
      ['delegate_pubkey', [32]],
      ['permissions', 'u64'],
      ['max_notional', 'u64'],
      ['expiry_slot', 'u64'],
    ],
  }],
]);

// è®¾ç½®æƒé™ï¼šå…è®¸äº¤æ˜“ï¼Œæœ€å¤§ 5000 USDC æ•å£
const PERM_TRADE = 1n << 0n;
const currentSlot = await connection.getSlot();
const expirySlot = BigInt(currentSlot) + 100_000n; // ~1å¤©åè¿‡æœŸ

const upsertData = new UpsertDelegateData({
  delegate_pubkey: apiKey.publicKey,
  permissions: PERM_TRADE,
  max_notional: 5000n * 1_000_000_000n, // 5000 USDC
  expiry_slot: expirySlot,
});

const upsertInstructionData = borsh.serialize(upsertDelegateSchema, upsertData);

// æ„é€ æŒ‡ä»¤
const upsertIx = new TransactionInstruction({
  keys: [
    { pubkey: delegatePDA, isSigner: false, isWritable: true },
    { pubkey: vaultPDA, isSigner: false, isWritable: true },
    { pubkey: owner.publicKey, isSigner: true, isWritable: true },
    { pubkey: globalConfigPDA, isSigner: false, isWritable: false },
    { pubkey: SystemProgram.programId, isSigner: false, isWritable: false },
  ],
  programId: PROGRAM_ID,
  data: Buffer.from(upsertInstructionData),
});

// å‘é€äº¤æ˜“
const upsertTx = new Transaction().add(upsertIx);
const upsertSig = await connection.sendTransaction(upsertTx, [owner]);
await connection.confirmTransaction(upsertSig);

console.log('âœ… API Key created! Signature:', upsertSig);
```

---

### 4. ä½¿ç”¨ API Key ææ¬¾

#### 4.1 ä½¿ç”¨ API Key ç­¾å

```typescript
// ææ¬¾æŒ‡ä»¤æ•°æ®
class WithdrawData {
  instruction = 3; // VaultInstruction::Withdraw
  amount: bigint;

  constructor(amount: bigint) {
    this.amount = amount;
  }
}

const withdrawSchema = new Map([
  [WithdrawData, {
    kind: 'struct',
    fields: [
      ['instruction', 'u8'],
      ['amount', 'u64'],
    ],
  }],
]);

// æå– 100 USDC
const withdrawAmount = 100n * 1_000_000_000n;
const withdrawData = new WithdrawData(withdrawAmount);
const withdrawInstructionData = borsh.serialize(withdrawSchema, withdrawData);

// æ„é€ æŒ‡ä»¤ï¼ˆä½¿ç”¨ delegate ç­¾åï¼‰
const withdrawIx = new TransactionInstruction({
  keys: [
    { pubkey: vaultPDA, isSigner: false, isWritable: true },
    { pubkey: apiKey.publicKey, isSigner: true, isWritable: false }, // delegate ç­¾å
    { pubkey: userUsdcAccount.address, isSigner: false, isWritable: true },
    { pubkey: vaultUsdcPDA, isSigner: false, isWritable: true },
    { pubkey: globalConfigPDA, isSigner: false, isWritable: false },
    { pubkey: TOKEN_PROGRAM_ID, isSigner: false, isWritable: false },
    { pubkey: delegatePDA, isSigner: false, isWritable: false }, // DelegateAccount
  ],
  programId: PROGRAM_ID,
  data: Buffer.from(withdrawInstructionData),
});

// ä½¿ç”¨ API Key ç­¾åå‘é€
const withdrawTx = new Transaction().add(withdrawIx);
const withdrawSig = await connection.sendTransaction(withdrawTx, [apiKey]);
await connection.confirmTransaction(withdrawSig);

console.log('âœ… Withdrawn 100 USDC using API Key! Signature:', withdrawSig);
```

---

### 5. æ’¤é”€ API Key

```typescript
// RevokeDelegate æŒ‡ä»¤æ•°æ®
class RevokeDelegateData {
  instruction = 5; // VaultInstruction::RevokeDelegate
  delegate_pubkey: Uint8Array;

  constructor(delegate_pubkey: PublicKey) {
    this.delegate_pubkey = delegate_pubkey.toBytes();
  }
}

const revokeSchema = new Map([
  [RevokeDelegateData, {
    kind: 'struct',
    fields: [
      ['instruction', 'u8'],
      ['delegate_pubkey', [32]],
    ],
  }],
]);

const revokeData = new RevokeDelegateData(apiKey.publicKey);
const revokeInstructionData = borsh.serialize(revokeSchema, revokeData);

// æ„é€ æŒ‡ä»¤ï¼ˆå¿…é¡»ç”± owner ç­¾åï¼‰
const revokeIx = new TransactionInstruction({
  keys: [
    { pubkey: delegatePDA, isSigner: false, isWritable: true },
    { pubkey: vaultPDA, isSigner: false, isWritable: true },
    { pubkey: owner.publicKey, isSigner: true, isWritable: false },
    { pubkey: globalConfigPDA, isSigner: false, isWritable: false },
  ],
  programId: PROGRAM_ID,
  data: Buffer.from(revokeInstructionData),
});

// å‘é€äº¤æ˜“
const revokeTx = new Transaction().add(revokeIx);
const revokeSig = await connection.sendTransaction(revokeTx, [owner]);
await connection.confirmTransaction(revokeSig);

console.log('âœ… API Key revoked! Signature:', revokeSig);
```

---

## API å‚è€ƒ

### æŒ‡ä»¤ç´¢å¼•

| æŒ‡ä»¤ | ç´¢å¼• | ç­¾åè€… | è¯´æ˜ |
|------|------|--------|------|
| `InitializeGlobalConfig` | 0 | Admin | åˆå§‹åŒ–å…¨å±€é…ç½® |
| `CreateVault` | 1 | Owner | åˆ›å»ºç”¨æˆ· Vault |
| `Deposit` | 2 | Owner | å­˜æ¬¾åˆ° Vault |
| `Withdraw` | 3 | Owner/Delegate | ä» Vault ææ¬¾ |
| `UpsertDelegate` | 4 | Owner | æ·»åŠ /æ›´æ–° API Key |
| `RevokeDelegate` | 5 | Owner | æ’¤é”€ API Key |
| `LockMargin` | 6 | Owner/Delegate | é”å®šä¿è¯é‡‘ |
| `UnlockMarginAndUpdatePnl` | 7 | Owner/Delegate | è§£é”ä¿è¯é‡‘ |
| `TransferAdmin` | 8 | Admin | è½¬ç§»ç®¡ç†å‘˜ |
| `RenounceAdmin` | 9 | Admin | æ”¾å¼ƒç®¡ç†å‘˜ |
| `FreezeVault` | 10 | Owner | å†»ç»“ Vault |
| `UnfreezeVault` | 11 | Owner | è§£å†» Vault |

### è´¦æˆ·éªŒè¯è§„åˆ™

| æ“ä½œ | Owner | Delegate + PERM_TRADE | Delegate + PERM_WITHDRAW |
|------|-------|----------------------|-------------------------|
| CreateVault | âœ… | âŒ | âŒ |
| Deposit | âœ… | âŒ | âŒ |
| Withdraw | âœ… | âŒ | âœ… |
| UpsertDelegate | âœ… | âŒ | âŒ |
| RevokeDelegate | âœ… | âŒ | âŒ |
| LockMargin | âœ… | âœ… | âŒ |

---

## å¸¸è§é—®é¢˜

### Q1: USDC Decimals æ˜¯å¤šå°‘ï¼Ÿ

A: é“¾ä¸Š USDC çš„ decimals æ˜¯ **9**ï¼ˆè€Œéæ ‡å‡†çš„ 6ï¼‰ã€‚æ‰€æœ‰é‡‘é¢è®¡ç®—éœ€è¦ä½¿ç”¨ `amount * 1_000_000_000`ã€‚

### Q2: å¦‚ä½•æŸ¥çœ‹ Vault ä½™é¢ï¼Ÿ

```bash
# æŸ¥çœ‹ Vault è´¦æˆ·
solana account <VAULT_PDA>

# æˆ–æŸ¥çœ‹ Vault USDC Token Account
spl-token balance <USDC_MINT> --owner <VAULT_USDC_PDA>
```

### Q3: API Key ç§é’¥ä¸¢å¤±æ€ä¹ˆåŠï¼Ÿ

A: 
1. ä½¿ç”¨ owner é’±åŒ…è°ƒç”¨ `RevokeDelegate` æ’¤é”€è¯¥ API Key
2. åˆ›å»ºæ–°çš„ API Key
3. API Key ç§é’¥ä¸¢å¤±ä¸å½±å“èµ„é‡‘å®‰å…¨ï¼Œowner å§‹ç»ˆæ‹¥æœ‰å®Œå…¨æ§åˆ¶æƒ

### Q4: å¦‚ä½•å®ç°å®Œå…¨éæ‰˜ç®¡ï¼Ÿ

A: ç®¡ç†å‘˜å¯ä»¥è°ƒç”¨ `RenounceAdmin` æŒ‡ä»¤ï¼Œå°† admin è®¾ä¸º `Pubkey::default()`ï¼Œä¹‹åæ— äººå¯ä»¥ä¿®æ”¹ GlobalConfigï¼Œå®ç°å®Œå…¨å»ä¸­å¿ƒåŒ–ã€‚

### Q5: Vault å¯ä»¥åŒæ—¶æœ‰å¤šå°‘ä¸ª API Keyï¼Ÿ

A: ç†è®ºä¸Šæ— é™åˆ¶ï¼Œæ¯ä¸ª API Key å¯¹åº”ä¸€ä¸ªç‹¬ç«‹çš„ DelegateAccount PDAã€‚

---

## ç›¸å…³æ–‡æ¡£

- **è®¾è®¡æ–‡æ¡£**: `docs/design.md` - è¯¦ç»†æ¶æ„è®¾è®¡
- **ä»£ç å®¡è®¡**: `CODE_AUDIT_REPORT.md` - å®Œæ•´å®¡è®¡æŠ¥å‘Š
- **éƒ¨ç½²æ€»ç»“**: `DEPLOYMENT_SUMMARY.md` - éƒ¨ç½²ä¿¡æ¯
- **éªŒè¯æŠ¥å‘Š**: `DEPLOYMENT_VERIFICATION.md` - éªŒè¯ç»“æœ

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-11-17  
**ç»´æŠ¤è€…**: 1024 Team

